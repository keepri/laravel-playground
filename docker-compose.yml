services:
  app:
    build:
      context: .
      args:
        APP_PORT: ${APP_PORT:-8000}
    ports:
      - "${APP_PORT:-8000}:${APP_PORT:-8000}"
    volumes:
      - .:/var/www/html
      - /var/www/html/vendor
    env_file:
      - .env
    depends_on:
      - queue

  queue:
    build: .
    command: php artisan queue:work --tries=3 --timeout=90
    volumes:
      - ./app:/var/www/html/app
      - ./config:/var/www/html/config
      - ./database:/var/www/html/database
      - ./routes:/var/www/html/routes
      - ./storage:/var/www/html/storage
      - ./.env:/var/www/html/.env
    env_file:
      - .env
    restart: unless-stopped
